2025.04.21
ë°”í…ë”© ì•± ì œì•ˆ
ê°€ìƒ ë°”í…ë” ìºë¦­í„°ë‘ ê°™ì´ ë§Œë“œëŠ” êµ¬ì„±ìˆìœ¼ë©´ ì¢‹ì„ë“¯.

ì •í˜•ì ì¸ ì¹µí…Œì¼ ë ˆì‹œí”¼ í™•ì¸, í•„í„°ë§

ì»¤ìŠ¤í…€ ë ˆì‹œí”¼ ê³µìœ 

ë¦¬íë¥´, ìœ„ìŠ¤í‚¤ ë“± ì£¼ë¥˜ êµ¬ë§¤ ì •ë³´ (ê°€ê²©, íŒë§¤ ìœ„ì¹˜ë“± í™•ì¸)

### ğŸ”¥ í•µì‹¬ ê¸°ëŠ¥

| ê¸°ëŠ¥ ì˜ì—­ | ê¸°ëŠ¥ | ì„¤ëª… |
| --- | --- | --- |
| ğŸ¹ ê¸°ë³¸ ë ˆì‹œí”¼ | **ì •í˜•í™”ëœ ì¹µí…Œì¼ DB** | ë§ˆê°€ë¦¬íƒ€, ë„¤ê·¸ë¡œë‹ˆ, ë§ˆí‹°ë‹ˆ ë“± ê¸°ë³¸ ë ˆì‹œí”¼ ì œê³µ + ì•Œì½”ì˜¬ ë„ìˆ˜, ì” ì¢…ë¥˜, ë„ìˆ˜ë³„ í•„í„°ë§ |
| ğŸ§‘â€ğŸ³ ê°€ìƒ ë°”í…ë” | **AI ë°”í…ë”ì™€ í•¨ê»˜ ë§Œë“¤ê¸°** | â€œì§€ê¸ˆ ê¸°ë¶„ì´ ì–´ë•Œìš”?â€, â€œìƒí¼í•œ ê±°, ë…í•œ ê±° ì–´ë–¤ ê±°ìš”?â€ â†’ ì¶”ì²œ & ëŒ€í™”í˜• ì§„í–‰ |
| ğŸ¨ ì»¤ìŠ¤í…€ ë ˆì‹œí”¼ | **ìì‘ ì¹µí…Œì¼ ê³µìœ ** | ìœ ì €ê°€ ìì‹ ë§Œì˜ ì¡°í•© ì‘ì„± + ì‚¬ì§„ & ì´ë¦„ ë“±ë¡ (íˆ¬í‘œ, ëŒ“ê¸€ ê¸°ëŠ¥) |
| ğŸ¾ ì£¼ë¥˜ ì •ë³´ | **ìˆ  êµ¬ë§¤ ê°€ì´ë“œ** | ë ˆì‹œí”¼ì— ì“°ì¸ ì£¼ë¥˜ â†’ ê°€ê²© ë¹„êµ, ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ íŒë§¤ì²˜ ì—°ë™ (ì „í†µì£¼ í¬í•¨ ì‹œ êµ­ì‚° ìœ„ì£¼ DB êµ¬ì¶•ë„ ê°€ëŠ¥) |
| ğŸ§­ í•„í„° ê¸°ëŠ¥ | **ì¬ë£Œ ê¸°ë°˜ ì¶”ì²œ** | "ë‚´ê°€ ê°€ì§„ ì¬ë£Œ: ì§„, ë¼ì„, ì„¤íƒ•" â†’ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì¹µí…Œì¼ ë¦¬ìŠ¤íŠ¸ |
| ğŸ† ì±Œë¦°ì§€ | **ì£¼ê°„ ì¹µí…Œì¼ ì±Œë¦°ì§€** | ì˜ˆ: 'ì´ë²ˆ ì£¼ì˜ ì¬ë£Œ: ìëª½ + ëŸ¼' â†’ ìœ ì €ë“¤ì´ ì°½ì‘ ì¡°í•© ì—…ë¡œë“œ í›„ ì¸ê¸°íˆ¬í‘œ |
| ğŸ¥ íŠœí† ë¦¬ì–¼ | **ì œì¡° ì˜ìƒ ê°€ì´ë“œ** | 1ì¸ì¹­ ì‹œì  ì˜ìƒ / ê°€ìƒ ë°”í…ë” ìŒì„± ì•ˆë‚´ / ì»µ/ë„êµ¬ ì„¤ëª… í¬í•¨ |

### ë„¤ì´ë° ì•„ì´ë””ì–´

- **ë°”í…ë”ì¦ˆ (BarTenders)**
- **ë¯¹ìŠ¤ì‡(MixIt)**
- **ì”ì—ë‹´ë‹¤**
- **ì¹µí´ë¦¬ì˜¤ (Cockfolio)** â€” ì¹µí…Œì¼ í¬íŠ¸í´ë¦¬ì˜¤
- **í•œ ì” ì¤„ê²Œìš”**

### ğŸ“ˆ í™•ì¥ ì•„ì´ë””ì–´

- ìœ„ìŠ¤í‚¤Â·ë¦¬íë¥´ ë§ˆë‹ˆì•„ ìœ„í•œ í…Œì´ìŠ¤íŒ… ê¸°ë¡ì¥
- ë„ìˆ˜Â·ë§› í”„ë¡œíŒŒì¼ ê¸°ë°˜ AI ì·¨í–¥ ë¶„ì„
- ì¹œêµ¬ì™€ ì¹µí…Œì¼ ëŒ€ê²° (íˆ¬í‘œí˜• ì´ë²¤íŠ¸)
- ì¹µí…Œì¼ ê²½í—˜ ê³µìœ  ì»¤ë®¤ë‹ˆí‹° + ê°ì„± ì¼ê¸°ì¥ ìŠ¤íƒ€ì¼


250422

ì•„ì´ë””ì–´ íšŒì˜ - ì‹¤í˜„ê°€ëŠ¥ì„±ì— ëŒ€í•´ì„œ

ë¬´ì „ê¸° ê°™ì€ê±´ ì‹¤íŒ¨(BLE X)

í•´ë´ë¼
ë¹„í–‰ê¸° ìƒí™© ì¢‹ë„¤
ì¢‹ì€ë° í•œì •ì§€ì„ í•„ìš”ìˆë‚˜?
ì§€í•˜, ì „ìŸ, êµ°ëŒ€ ë“± ë“± ë“± ë“± ë“± 

ì¸í„°ë„· ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì‹ ì €.
ì¸í„°ë„· ì—†ì„ ë•Œì˜ ëª¨ë“œë¥¼ ë”°ë¡œ ë‘¬ì•¼í•˜ë‚˜?
ë°ì´í„°ë“¤ì„ í”„ë¡ íŠ¸ì—ì„œ ê°€ì§€ê³  ìˆì–´ì•¼í• ë“¯

í™”ë©´ì  ë³´ë‹¤ëŠ” ê¸°ìˆ ì ìœ¼ë¡œ ë¹¡ì„¸ê¸´í•˜ë‹¤

êµ¬í˜„ë§Œ í•˜ë©´ëœë‹¤

ì˜¤í”„ë¼ì¸ë§µ
ì§€ë„ - í´ë§ë°©ì‹
ë§ˆì§€ë§‰ì— ëë˜ ì‹œì  ê¸°ì¤€

ê°€ì¥í° MVPí•˜ë‚˜ ì¡ê³  ê·¸ì™¸ì˜ ê²ƒë“¤ì„ ë°°ì œì‹œì¼œê°€ë©´ì„œ
ì±„íŒ…ë¶€í„° ë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ê·¸ í›„ì— í•˜ë‚˜ì”© ì¶”ê°€?

ì•„ì´í°ì´ ê°€ëŠ¥í•œê°€?
NATIVEì ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤ë©´ ì½”ë“œê°€ 2ì¤‘ìœ¼ë¡œ...

êµë³´ì¬ë¡œ S10ì‹ ì²­í•˜ì(2ê°œ)
ì½”í‹€ë¦°ì´ í’€ìŠ¤íƒ

ìŠ¤í”„ë§ë¶€íŠ¸ê°€ í•„ìš”ê°€ ì—†ë‹¤..?
ì½”í‹€ë¦°ë§Œ ì¨ì•¼í•œë‹¤ëŠ”..?
í†µì‹ ì´ì•ˆë˜ëŠ”ë° ìŠ¤í”„ë§ë¶€íŠ¸ê°€ ì–´ë–»ê²Œ ëŒì•„ê°€ë‚˜ë‚˜
ë¡œì»¬ì—ì„œ....... ì›¹ì†Œìº£ì±„íŒ…êµ¬í˜„
EC2ë„ í•„ìš”ê°€ì—†ë‚˜.? -> ì§€ë„ ë°ì´í„° ê°€ì ¸ì˜¤ê³  ìºì‹±í•˜ê³  í• ë ¤ë©´ í•„ìš”ëŠ” í• ë“¯
í„°ì§ˆë•Œë„ ì¨ì•¼í•˜ë‹ˆê¹Œ ì¼ë‹¨ í•„ìš”í•˜ë‹¤. .  . 
1ì‹œê°„ ë‚´ ëŒ€í™”ë¼ë˜ì§€ ìµœê·¼ 30ê°œ ëŒ€í™”ë¼ë˜ì§€ë§Œ ì €ì¥ë˜ë„ë¡ í•´ì„œ..

ê¸°ìˆ ì ìœ¼ë¡œ ë ì§€?
ë°±ì•¤ë“œì ì¸ë¶€ë¶„ ì¡°ì‚¬ í•„ìš”
ì–»ì–´ê°€ëŠ” ë¶€ë¶„ì´ ìˆê¸´í• ë“¯
ë¸”ë£¨íˆ¬ìŠ¤ ì±„íŒ…ì´ MVPì´ë©´ ì±„íŒ…ì„ ìœ„í•´ì„œëŠ” ë°±ì•¤ë“œëŠ” ì—†ì–´ë„ ë ë“¯ - > ìŠ¤í”„ë§ì„œë²„ê°€ ë„¤íŠ¸ì›Œí¬ë¡œ í†µì‹ í•˜ëŠ”ë° ê·¸ê±¸ ì“°ì§ˆì•Šìœ¼ë‹ˆê¹Œ ì¡´ì¬í•  í•„ìš”ëŠ” ì—†ë‹¤.
ë¸”ë£¨íˆ¬ìŠ¤ë¡œ í†µì‹ í•˜ë©´ ì €ì¥ì´ ë˜ë‚˜..?
ì–´ë–»ê²Œ ë™ê¸°í™” í• ì§€
6ëª…ì—ì„œ í•œë‹¤ ìƒê°í•˜ë©´ MESH ë§ ì–´ë–»ê²Œ í• ì§€..
1ëŒ€1ì´ë©´ ì˜ë¯¸ê°€ ì—†ì§€ ì•Šë‚˜.. ì—†ì§„ ì•Šë‹¤.

ë©€ë¦¬ìˆëŠ” ì‚¬ëŒì¸ë° ì¤‘ê°„ì‚¬ëŒ ê±°ì³ì„œ ë©€ë¦¬ìˆëŠ” ì‚¬ëŒê³¼ ëŒ€í™”í•˜ëŠ” ê±°ë©´ íŠ¹ìƒ‰ì´ ë˜ê²Œ ìˆì„ë“¯

ë¸Œë¦¿ì§€íŒŒì´?
-> ì—†ì–´ì§„ë“¯
íŒŒì´ì–´ì±—?
-> ì™¸êµ­ê±°ê±°

ë³¼ë¥¨ì€ ì•ˆí°ë° ê¸°ìˆ ì˜ ê¹Šì´ê°€ ê¹Šë‹¤
í¬ì¥ë§Œ ì˜í•˜ë©´ êµ¿

AIìš”ì†Œ ì¶”ê°€í•  ê±° ì—†ì„ê¹Œ?

2025.04.24
ì•ˆë“œë¡œì´ë“œ ìŠ¤íŠœë””ì˜¤ ì„¤ì¹˜ í›„ ì‚¬ìš© ë°©ë²• ì—°êµ¬.
BLE í†µì‹ ì„ ìœ„í•œ ì½”ë“œ êµ¬ì„±
BLE ì‹ í˜¸ë¥¼ íƒìƒ‰í•˜ê¸° ìœ„í•œ ì½”ë“œ êµ¬í˜„
![alt text](image.png)
ì—ë®¬ë ˆì´ì…˜ìœ¼ë¡œëŠ” ì •ìƒì‘ë™í•˜ì§€ë§Œ ì‹¤ì œ í°ìœ¼ë¡œ ì•ˆí•´ë´ì„œ ê²€ì¦ í•„ìš”

2025.04.25
ë³´ì•ˆ ì—°êµ¬

**SIGNAL PROTOCOL**

- ê°•ë ¥í•œ ì „ë°© ë¹„ë°€ì„± (forward secrecy) ê³¼ ì¹¨í•´ í›„ ë³´ì•ˆì„± (post-compromise security) ì„ ì œê³µí•˜ëŠ” í˜„ëŒ€ì  ë©”ì‹œì§• ì•”í˜¸í™” í”„ë¡œí† ì½œ

-í•µì‹¬ ì›ë¦¬

- **Identity Key Pair**
    - ì¥ê¸° í‚¤ ìŒ. ê° ë””ë°”ì´ìŠ¤ê°€ í•œ ë²ˆ ìƒì„±í•˜ì—¬ ì•ˆì „í•˜ê²Œ ë³´ê´€
- **Signed PreKey**
    - ì¤‘ê¸° í‚¤ ìŒ. Identity Keyë¡œ ì„œëª…ëœ ê³µê°œí‚¤. íƒˆì·¨ë˜ë©´ ì¼ì • ê¸°ê°„ë§Œ ìœ íš¨
- **One-time PreKey**
    - ì¼íšŒìš© ë‹¨ê¸° í‚¤ ìŒ. ì´ˆê¸° í•¸ë“œì…°ì´í¬ì—ë§Œ ì‚¬ìš©
- **PreKeyBundle**
    - ìœ„ ì„¸ ê°€ì§€ ê³µê°œí‚¤ì™€ ì‚¬ìš©ì ë“±ë¡ IDë¥¼ ë¬¶ì–´ â€œì²˜ìŒ ë§Œë‚  ë•Œâ€ êµí™˜

â€» í•¸ë“œì…°ì´í¬ë€?

â‡’ë‹¨ìˆœíˆ **ì²« í‚¤ êµí™˜**ì´ ì•„ë‹ˆë¼, ê·¸ êµí™˜ì„ í†µí•´ **ì„¸ì…˜ì˜ ëª¨ë“  í–¥í›„ ì•”í˜¸í™”Â·ë³µí˜¸í™” ë™ì‘ì„ ë³´ì¥í•  ìˆ˜ ìˆëŠ” ì´ˆê¸° ìƒíƒœ**ë¥¼ ë§Œë“œëŠ” ì¼ë ¨ì˜ ê³¼ì •
- PreKeyBundle íšë“ â†’ Diffie-Hellman êµí™˜ â†’ ì´ˆí‚¤ ë£¨íŠ¸í‚¤ ë° ì²´ì¸í‚¤ ìƒì„± â†’ì„¸ì…˜ ë ˆì½”ë“œ ì €ì¥

â€» Diffie-Hellman(DH)ë€?

- ì„œë¡œ ë¹„ë°€ ì±„ë„ ì—†ì´ë„ ê³µí†µì˜ ë¹„ë°€ê°’ì„ ì•ˆì „í•˜ê²Œ ìƒì„±
- ê³µê°œëœ ìˆ«ì(p, g) ì•„ë˜ì—ì„œ ê°ì ë¹„ë°€ ì§€ìˆ˜(a, b)ë¥¼ ì„ íƒí•´

![image.png](attachment:61f0102c-88ba-4ddf-96d6-f119319a872d:image.png)

- **Double Ratchet**ì—ì„œëŠ” ë§¤ ë©”ì‹œì§€ ë˜ëŠ” ì£¼ê¸°ë§ˆë‹¤ ìƒˆë¡œìš´ DH í‚¤ ìŒì„ ìƒì„±í•´ ìœ„ ê³¼ì •ì„ ë°˜ë³µ â†’ **Forward Secrecy** ê°•í™”

â€» PreKeyBundle í”Œë¡œìš°

- **A**ê°€ ì„œë²„ì— ìì‹ ì˜ PreKeyBundle ì—…ë¡œë“œ
- **B**ê°€ Aì—ê²Œ ë©”ì‹œì§€ ë³´ë‚¼ ë•Œ, ì„œë²„ë¡œë¶€í„° Aì˜ PreKeyBundleë¥¼ ê°€ì ¸ì˜´
- **B**ëŠ”
    - ìì‹ ì˜ DH ê³µê°œí‚¤ B_DH
    - PreKeyBundle ë‚´
        
        ![image.png](attachment:ccb2f3be-b787-454c-b405-d5bb82314781:image.png)
        
        (ì¤‘ê¸° í‚¤, ì¼íšŒìš© í‚¤)ë¥¼ ì´ìš©í•´ ì´ˆê¸° DH êµí™˜ ìˆ˜í–‰
        
- **A**ëŠ” Bì˜ ì²« ë©”ì‹œì§€ í—¤ë”ì— í¬í•¨ëœ B_DHë¡œë¶€í„° ëŒ€ì‘ DH ì—°ì‚° ìˆ˜í–‰
- ì´í›„ ì–‘ì¸¡ ëª¨ë‘ **SessionRecord**ì— root key, chain key ë“±ì„ ì €ì¥

## Double Ratchet ë©”ì»¤ë‹ˆì¦˜

Signal Protocolì˜ í•µì‹¬ì€ ë‘ ê°€ì§€ â€˜ë˜ì¹«(ratchet)â€™ì„ ë²ˆê°ˆì•„ ê°€ë©° ëŒë¦¬ëŠ” êµ¬ì¡°

| Ratchet ì¢…ë¥˜ | ì—­í•  |
| --- | --- |
| **Diffieâ€“Hellman Ratchet** | ì£¼ê¸°ì ìœ¼ë¡œ ìƒˆë¡œìš´ DH í‚¤ ìŒì„ ìƒì„± â†’ ë£¨íŠ¸ í‚¤(root key) ê°±ì‹  |
| **Symmetric-Key Ratchet** | ê° ë©”ì‹œì§€ë§ˆë‹¤ ëŒ€ì¹­í‚¤(chain key)ë¡œë¶€í„° ë©”ì‹œì§€ í‚¤(message key) íŒŒìƒ |

### 1. ì´ˆê¹ƒê°’ ì„¤ì •: PreKeyBundle êµí™˜ â†’ Root Key ì´ˆê¸°í™”

- **ë˜ì¹« ì¢…ë¥˜**: **DH Ratchet (ì²« í•¸ë“œì…°ì´í¬ ë‹¨ê³„)**
- **ë™ì‘**:
    1. Aì˜ PreKeyBundle(Identity PK, Signed PreKey, One-time PreKey)ê³¼ Bì˜ ì„ì‹œ DH í‚¤ ê³µê°œê°’ B_DHì„ êµí™˜
    2. ê°ì DH ì—°ì‚°ì„ í†µí•´ **Root Key** ìƒì„±

> ì´ ê³¼ì •ìœ¼ë¡œ â€œì²« ë²ˆì§¸â€ Root Keyê°€ ì„¸ì…˜ì— ì„¤ì •
> 

---

### 2. ë©”ì‹œì§€ ì „ì†¡ ì‹œ ë˜ì¹«

### 2-a. (Optional) ìƒˆë¡œìš´ DH í‚¤ ìƒì„± â†’ Root Key ê°±ì‹ 

- **ë˜ì¹« ì¢…ë¥˜**: **DH Ratchet**
- **ë™ì‘**:
    1. ì†¡ì‹  ì¸¡ì´ ìƒˆ DH í‚¤ ìŒ ìƒì„±
    2. í—¤ë”ì— ìƒˆ ê³µê°œí‚¤  í¬í•¨
    3. ìˆ˜ì‹  ì¸¡ì´ ë‹¤ì‹œ DH ì—°ì‚° â†’ ìƒˆë¡œìš´ Root Key ê³„ì‚°

> ì´ DH ê²Œì´íŠ¸ì›¨ì´ë¥¼ ëŒë¦¬ëŠ” ìˆœê°„ë§ˆë‹¤ â€œë£¨íŠ¸ ì‹œí¬ë¦¿â€ì´ ì•ˆì „í•˜ê²Œ ì¬ê°±ì‹ 
> 

### 2-b. Chain Key â†’ Message Key íŒŒìƒ â†’ AES-GCM ì•”í˜¸í™”+MAC

- **ë˜ì¹« ì¢…ë¥˜**: **Symmetric-Key Ratchet**
- **ë™ì‘**:
    
    ![image.png](attachment:87c7e577-bfee-486f-82c7-834d71702b11:image.png)
    

> ì´ ëŒ€ì¹­ ë˜ì¹«ì€ â€œê° ë©”ì‹œì§€ë§ˆë‹¤ ë…ë¦½ì ì¸ ëŒ€ì¹­í‚¤â€ë¥¼ ë§Œë“¤ì–´ì„œ, ê³¼ê±° í‚¤ ë…¸ì¶œ ì‹œì—ë„ ì´í›„ ë©”ì‹œì§€ì—ëŠ” ì˜í–¥ X
> 

---

### 3. ìˆ˜ì‹  ì¸¡ ë³µí˜¸í™”

- **DH Ratchet ì ìš©**: í—¤ë”ì˜ DH ê³µê°œí‚¤ë¡œ Root Key ê°±ì‹  (2-a)
- **Symmetric Ratchet ì ìš©**: ìì‹ ì˜ Chain Keyë¡œ ì˜¬ë°”ë¥¸ Message Key íŒŒìƒ â†’ ë³µí˜¸í™” (2-b)

---

## ê²°ë¡ 

- **PreKeyBundle êµí™˜ê³¼ â€œìƒˆ DH í‚¤â€ ì£¼ê³ ë°›ê¸°**ê°€ **DH Ratchet**
- **Chain Key(KDF)â†’Message Key íŒŒìƒ í›„ AEAD ì•”í˜¸í™”**ê°€ **Symmetric-Key Ratchet**
- ë”°ë¼ì„œ â€œì´ˆê¸° í•¸ë“œì…°ì´í¬â€ë¶€í„° â€œë©”ì‹œì§€ ì•”í˜¸í™”â€ê¹Œì§€ì˜ ì „ ê³¼ì •ì„ **ë‘ ë˜ì¹«ì´ í˜‘ë ¥**

## libsignal-protocol-java êµ¬ì¡°

Signal íŒ€ì—ì„œ ê³µê°œí•œ ìë°” êµ¬í˜„ì²´ì´ë©°, ì£¼ìš” í´ë˜ìŠ¤:

- `KeyHelper` : Identity Key, PreKey, SignedPreKey ìƒì„±
- `SignalProtocolStore` : í‚¤Â·ì„¸ì…˜ ìƒíƒœ ì €ì¥ ì¸í„°í˜ì´ìŠ¤
- `PreKeyBundle` : í•¸ë“œì…°ì´í¬ìš© í‚¤ ë¬¶ìŒ
- `SessionBuilder` : ì´ˆê¸° í•¸ë“œì…°ì´í¬ ì²˜ë¦¬ (PreKeyBundle â†’ ì„¸ì…˜ ë ˆì½”ë“œ)
- `SessionCipher` : ì‹¤ì œ ë©”ì‹œì§€ ì•”í˜¸í™”/ë³µí˜¸í™”

ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ **Double Ratchet ëª¨ë“  ë™ì‘**ì„ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•´ ì£¼ë¯€ë¡œ, ìš°ë¦¬ëŠ”

1. í‚¤ ìƒì„± & ë²ˆë“¤ êµí™˜
2. `SessionBuilder.process()`
3. `SessionCipher.encrypt()/decrypt()`

ë§Œ í˜¸ì¶œí•´ ì£¼ë©´ë¨

â€» AES-GCMì´ë€?

![image.png](attachment:e9c372a7-d6f7-45ad-8b3c-46a4ae732136:image.png)

## MAC (Message Authentication Code)

- **ëª©ì **: ë©”ì‹œì§€ê°€ ì „ì†¡ ë„ì¤‘ ë³€ì¡°ë˜ì§€ ì•Šì•˜ìŒì„ ê²€ì¦
- **GCMì˜ MAC**: GHASH

![image.png](attachment:51e39173-a528-46c0-8f08-74d2c06239c9:image.png)

![image.png](attachment:660a80f3-9d73-46d6-817a-3528f88c3618:image.png)

| ê°œë… | ê¸°ëŠ¥/ë°©ì‹ |
| --- | --- |
| **DH (Diffieâ€“Hellman)** | ê³µê°œí‚¤ êµí™˜ìœ¼ë¡œ ê³µìœ  ë¹„ë°€ ìƒì„± (forward secrecy) |
| **PreKeyBundle** | ì˜¤í”„ë¼ì¸ í‚¤ êµí™˜ì„ ìœ„í•œ ì‚¬ì „ ê³µê°œí‚¤ ë¬¶ìŒ (Identity, SignedPreKey, One-time) |
| **Chain Key** | KDFë¡œë¶€í„° ë©”ì‹œì§€ í‚¤ íŒŒìƒ â†’ ê° ë©”ì‹œì§€ë§ˆë‹¤ ë…ë¦½ í‚¤ ì œê³µ |
| **AES-GCM** | AES-CTR ì•”í˜¸í™” + GHASH MAC ìœ¼ë¡œ ê¸°ë°€ì„±Â·ë¬´ê²°ì„± ë³´ì¥ |
| **MAC (GHASH íƒœê·¸)** | ë³€ì¡° ê²€ì¦ìš© íƒœê·¸, ìˆ˜ì‹  ì¸¡ ì¬ê²€ì¦ â†’ ì¸ì¦ ì‹¤íŒ¨ ì‹œ íê¸° |

## Signal Protocolì—ì„œì˜ KDF

### 3-1. Root Key â†’ Chain Key

- DH Ratchet ê²°ê³¼ë¬¼ì¸ ë£¨íŠ¸ í‚¤(RK)ë¥¼ **HMAC ê¸°ë°˜ KDF**ì— ë„£ì–´ì„œ
    
    ```
    CK0 = KDF_root(RK,  â€œChainâ€)
    ```
    

### 3-2. Chain Key â†’ ë‹¤ìŒ Chain Key + Message Key

- Symmetric-Key Ratchet ë‹¨ê³„ì—ì„œëŠ” ë§¤ ë©”ì‹œì§€ë§ˆë‹¤
    
    ```
    CK_{n+1} = HMAC(CK_n, 0x01)
    MK_n     = HMAC(CK_n, 0x02)
    ```
    
    ì™€ ê°™ì€ ë‹¨ìˆœ HMAC-KDF êµ¬ì¡°ë¥¼ ì”ë‹ˆë‹¤.
    
    - `0x01`, `0x02`ëŠ” êµ¬ë¶„ì(label) ì—­í• 
    - ì´ë ‡ê²Œ í•˜ë©´ ë©”ì‹œì§€ ìˆœì„œì™€ ë¬´ê´€í•˜ê²Œ ê° `MK_n`ì„ ë…ë¦½ì ìœ¼ë¡œ ë³µì›í•  ìˆ˜ ìˆê³ ,
        
        ê³¼ê±° CKë‚˜ MK ë…¸ì¶œ ì‹œ ì´í›„ í‚¤ëŠ” ì•ˆì „í•˜ê²Œ ì§€í‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        

## ğŸ“¨ 1. ì‹ ë¶„ì¦ëª… (Identity Key)

- **ë¹„ìœ **: í¸ì§€ë¥¼ ë³´ë‚¼ ë•Œ ë‚´ ì–¼êµ´ì´ ì°íŒ ì‹ ë¶„ì¦
- **ì—­í• **: â€œì´ í¸ì§€ëŠ” ì§„ì§œ **ë‚˜**ê°€ ë³´ë‚¸ ê±°ì•¼â€ ë¼ê³  ì¦ëª…

---

## ğŸ” 2. ë¯¸ë¦¬ ì¤€ë¹„ëœ ì ê¸ˆì¥ì¹˜ë“¤ (PreKeyBundle)

- **ë¹„ìœ **: ìš°ì²´êµ­ì— ë§¡ê²¨ ë‘” **ì—¬ëŸ¬ ê°œì˜ ì ê¸ˆì¥ì¹˜(ìë¬¼ì‡ )**
    - ì¤‘ê°„ìš© ìë¬¼ì‡ (ê´€ë¦¬ì ì„œëª…ëœ Signed PreKey)
    - ì¼íšŒìš© ìë¬¼ì‡ (One-time PreKey)
- **ì—­í• **: ìƒëŒ€ê°€ **ì˜¤í”„ë¼ì¸**ì´ë”ë¼ë„, ì´ ìë¬¼ì‡ ë¥¼ ê°€ì ¸ë‹¤ ì“¸ ìˆ˜ ìˆê²Œ í•¨

---

## ğŸ¤ 3. ì²« ì†ì¡ì´ â€“ í•¸ë“œì…°ì´í¬

1. **ì‚¬ì „ ì¤€ë¹„**
    - A(ìˆ˜ì‹ ì)ëŠ” ìš°ì²´êµ­(ì„œë²„)ì— ìë¬¼ì‡  ë¬¶ìŒ(PreKeyBundle)ì„ ë³´ê´€
2. **ë¹„ë°€ ì•½ì†**
    - B(ì†¡ì‹ ì)ëŠ” Aì˜ ìë¬¼ì‡  í•˜ë‚˜ë¥¼ êº¼ë‚´ ì™€ì„œ ë‚´ ì†ì¡ì´ìš© ì—´ì‡ (ì„ì‹œ DH í‚¤)ë¥¼ ë§Œë“¤ì–´ í—¤ë”ì— ë¶™ì„
3. **ê³µë™ ë¹„ë°€ ìƒì„±**
    - AëŠ” Bê°€ ë¶™ì—¬ ë³´ë‚¸ ì—´ì‡ ë¥¼ ë°›ì•„ì„œ, ìê¸° ìë¬¼ì‡ ì™€ ë§ì¶° ë³´ê³  ë™ì¼í•œ **ê³µë™ ë¹„ë°€ê°’(shared secret)** ì„ ìƒì„±
4. **ì²« ìƒíƒœ ì €ì¥**
    - ì´ ìˆœê°„ì´ â€œì²« ë²ˆì§¸ ì•½ì†(ë£¨íŠ¸í‚¤)â€ì´ê³ , ì´í›„ í¸ì§€ êµí™˜ì˜ **ê¸°ì¤€ì **ì´ ë¨

---

## ğŸ”„ 4. í¸ì§€ë§ˆë‹¤ ë°”ë€ŒëŠ” ìë¬¼ì‡  (Double Ratchet)

### A. ìƒˆë¡œìš´ ìë¬¼ì‡  êµí™˜ â€“ DH Ratchet

- ë§¤ë²ˆ â€œì˜¤ëŠ˜ì˜ ìë¬¼ì‡ â€ë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ ì„œë¡œ ì£¼ê³ ë°›ìœ¼ë©´
- **ëˆ„ê°€ ë³´ë©´ ê³¼ê±° ì•½ì†ì€ ëª°ë¼ë„, ì§€ê¸ˆ ì•½ì†ë§Œ ì•Œê³  ìˆê² ì£ ?** â†’ ì „ë°© ë¹„ë°€ì„±

### B. ìë¬¼ì‡ ì—ì„œ ìƒˆ ì—´ì‡  êº¼ë‚´ê¸° â€“ Symmetric Ratchet

- ê° í¸ì§€ë§ˆë‹¤
    1. ê°€ì¥ ìµœê·¼ ìë¬¼ì‡ ì—ì„œ **ë‹¤ìŒ ì—´ì‡ (chain key)** ë¥¼ ë½‘ê³ 
    2. ê·¸ ì—´ì‡  í•˜ë‚˜ë¥¼ **ì‹¤ì œ í¸ì§€ ë´‰ì¸(message key)** ì— ì‚¬ìš©
- **í¸ì§€ë§ˆë‹¤ ë‹¤ë¥¸ ì—´ì‡ **ë¥¼ ì“°ë‹ˆê¹Œ, í•˜ë‚˜ ì—´ì‡ ê°€ ìœ ì¶œë¼ë„ ë‹¤ë¥¸ í¸ì§€ëŠ” ì•ˆì „

---

## ğŸ”‘ 5. ë´‰ì¸ê³¼ ì¸ì¦ â€“ AES-GCM

- **ë´‰ì¸(AES-CTR)**: ë©”ì‹œì§€ë¥¼ ê°ì‹¸ëŠ” ë°€ë´‰ í¬ì¥
- **ì¸ì¦(GHASH-MAC)**: í¬ì¥ì„ ëœ¯ì–´ë³´ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” **ì”°(seal)**
- ì´ ë‘ ê°€ì§€ë¥¼ í•©ì³ì„œ **AEAD**ë¼ê³  ë¶€ë¥´ê³ ,
    
    â€œë´‰ì¸ê³¼ ì”°ì´ ëª¨ë‘ ë™ì¼í•´ì•¼ë§Œ ì—´ì–´ë³¼ ìˆ˜â€ ìˆê²Œ í•´ ì¤ë‹ˆë‹¤.
    

---

## ğŸ—ºï¸ ì „ì²´ íë¦„

```
[ì¤€ë¹„] A â†’ ì„œë²„ì— ìë¬¼ì‡  ë¬¶ìŒ(PreKeyBundle) ë³´ê´€
[í•¸ë“œì…°ì´í¬] B â†’ A ìë¬¼ì‡ ë¡œ ì²« ì—´ì‡  êµí™˜ â†’ ê³µë™ ë¹„ë°€ ìƒì„± â†’ ë£¨íŠ¸í‚¤ ì„¤ì •
[í¸ì§€1]   B â†’ ë£¨íŠ¸í‚¤â†’ì²´ì¸í‚¤â†’ë©”ì‹œì§€í‚¤ ë½‘ì•„ ë´‰ì¸ â†’ Aê°€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì—´ì–´ë³´ê¸°
[í¸ì§€2]   (ì˜µì…˜) ìƒˆ ìë¬¼ì‡  êµí™˜ â†’ ìƒˆë¡œìš´ ë£¨íŠ¸í‚¤ â†’ ë‹¤ì‹œ ì²´ì¸í‚¤ ë½‘ì•„ ë´‰ì¸ â†’ ë³µí˜¸í™”
```

- **í•¸ë“œì…°ì´í¬**: ì²« ë²ˆì§¸ **ì•ˆì „í•œ ì•½ì†**
- **DH Ratchet**: ìƒˆ ìë¬¼ì‡  ì£¼ê³ ë°›ê¸°
- **Symmetric Ratchet**: ìë¬¼ì‡  í•˜ë‚˜ì—ì„œ ë§¤ë²ˆ ë‹¤ë¥¸ ì—´ì‡  êº¼ë‚´ ì“°ê¸°
- **AES-GCM**: í¸ì§€ ë´‰ì¸ + ë¬´ê²°ì„± ê²€ì¦

## ë‚´ í”„ë¡œì íŠ¸ì— X3DHê°€ ì í•©í• ê¹Œ?

- **ì¥ì **
    - **ë¹„ë™ê¸°ì„±**: ìˆ˜ì‹ ìê°€ ì˜¤í”„ë¼ì¸ì¼ ë•Œì—ë„(ì˜ˆ: ì „ì›ì´ êº¼ì ¸ ìˆê±°ë‚˜ ë²”ìœ„ ë°–ì´ì–´ë„)
        - ì†¡ì‹ ìëŠ” PreKeyBundleë§Œ ìˆìœ¼ë©´ ì–¸ì œë“  ì²« ë©”ì‹œì§€ë¥¼ ì•”í˜¸í™”í•´ ë³´ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - **ë©”ì‹œì§€ ì§€ì—° í—ˆìš©**: ë©”ì‹œì§€ê°€ ì¤‘ê°„ ë…¸ë“œì— ì ì‹œ ë¨¸ë¬¼ëŸ¬ë„, ë‚˜ì¤‘ì— ìˆ˜ì‹ ìê°€ ëŒì•„ì˜¤ë©´ ë³µí˜¸í™” ê°€ëŠ¥
- **ë‹¨ì **
    - **ì¸í”„ë¼ í•„ìš”**: PreKeyBundle(IdentityPK, SignedPreKey, One-timePreKey)ì„
        - ì¤‘ì•™ ì„œë²„ë‚˜ Mesh ë‚´ ë¶„ì‚° ì €ì¥ì†Œ(ë˜ëŠ” BLE ê´‘ê³  íŒ¨í‚·/GATT í†µí•´ ì£¼ê¸°ì  ë°°í¬) ê°™ì€ ë°©ì‹ìœ¼ë¡œ
        - **ì•ˆì „í•˜ê²Œ** ë°°í¬Â·ê°±ì‹ í•  ìˆ˜ ìˆëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
    - **ì˜¤ë²„í—¤ë“œ**: ì¶”ê°€ DH ì—°ì‚°(ì´ 3~4íšŒ)ê³¼ PreKeyBundle êµí™˜ìœ¼ë¡œ ì¸í•œ ì½”ë“œÂ·ë°ì´í„° ë³µì¡ë„ ì¦ê°€

EX)

## 1. ì´ˆê¸°í™” & í‚¤ ìƒì„±

```kotlin

object CryptoManager {
    private lateinit var store: SignalProtocolStore
    private lateinit var identity: IdentityKeyPair
    private var registrationId: Int = 0

    fun initialize(context: Context) {
        // In-Memory ìŠ¤í† ì–´ ìƒì„± (ì‹¤ì œë¡  ì˜êµ¬ ì €ì¥ì†Œ í•„ìš”)
        store = InMemorySignalProtocolStore()
        // ì¥ê¸° Identity í‚¤ ìŒ ìƒì„±
        identity = KeyHelper.generateIdentityKeyPair()
        // registrationId ìƒì„±
        registrationId = KeyHelper.generateRegistrationId(false)
    }
    ...
}

```

- **IdentityKeyPair**: Signal Protocolì˜ ì¥ê¸° í‚¤. ì•± ë‹¹ í•œ ë²ˆë§Œ ìƒì„±í•´ì„œ ë³´ê´€
- **SignalProtocolStore**: í‚¤Â·ì„¸ì…˜ ìƒíƒœ ë³´ê´€ì†Œ. ë‚´ë¶€ì ìœ¼ë¡œ ê°ì¢… `SessionRecord`, `PreKeyRecord` ë“±ì„ ì €ì¥

ì—¬ê¸°ê¹Œì§€ê°€ â€œëˆ„êµ´ ë§Œë‚˜ë“  ì‚¬ìš©í•  ë‚´ í‚¤(material)â€ì„ ì„¸íŒ…í•˜ëŠ” ë‹¨

---

## 2. PreKeyBundle ìƒì„± (í•¸ë“œì…°ì´í¬ ì¤€ë¹„)

```kotlin

fun generatePreKeys(): PreKeyBundle {
    val preKeyId = 1
    val signedPreKeyId = 1

    // One-time PreKey (ì¼íšŒìš© ë‹¨ê¸° í‚¤)
    val preKeyPair = KeyHelper.generatePreKey(preKeyId)
    // Signed PreKey (ì¤‘ê¸° í‚¤, identity í‚¤ë¡œ ì„œëª…ë¨)
    val signedPreKeyPair = KeyHelper.generateSignedPreKey(identity, signedPreKeyId)

    return PreKeyBundle(
        registrationId,           // ë‚´ registration ID
        1,                        // ë‚´ ê¸°ê¸° ID (subdevice)
        preKeyPair.id,            // One-time PreKey ID
        preKeyPair.keyPair.publicKey,
        signedPreKeyId,           // Signed PreKey ID
        signedPreKeyPair.keyPair.publicKey,
        signedPreKeyPair.signature,
        identity.publicKey        // Identity ê³µê°œí‚¤
    )
}

```

- **PreKeyBundle**: ì´ˆê¸° í•¸ë“œì…°ì´í¬ì— ì‚¬ìš©ë˜ëŠ” ê³µê°œí‚¤ ë¬¶ìŒ.
- ì„œë²„ë‚˜ ì•ˆì „ ì±„ë„ì„ í†µí•´ ìƒëŒ€ë°©ì—ê²Œ ì „ë‹¬ â†’ â€œì²« í‚¤ êµí™˜â€ì˜ ì¬ë£Œê°€ ë¨.

---

## 3. ì•”í˜¸í™”: `encrypt(...)`

```kotlin

fun encrypt(remoteAddress: SignalProtocolAddress, plain: ByteArray): CiphertextMessage {
    // 1) ì´ˆê¸° DH Ratchet: ì²« ë©”ì‹œì§€ ì „ ì„¸ì…˜ ì´ˆê¸°í™”
    val builder = SessionBuilder(store, remoteAddress)
    builder.process(generatePreKeys())

    // 2) ë©”ì‹œì§€ ì•”í˜¸í™” & Symmetric Ratchet
    val cipher = SessionCipher(store, remoteAddress)
    return cipher.encrypt(plain)
}

```

1. **`SessionBuilder.process(generatePreKeys())`**
    - ë‚´ë¶€ì ìœ¼ë¡œ
        - `PreKeyBundle`ì— ë‹´ê¸´ Signed PreKey, One-time PreKeyì™€ ë‚˜ì˜ identity keyë¡œ DH ì—°ì‚°
        - ê·¸ ê²°ê³¼ë¡œ **root key**ë¥¼ ì´ˆê¸°í™”
    - ì´ ìˆœê°„ì´ **DH Ratchet**ì˜ í•µì‹¬: ì²« ë²ˆì§¸ shared secretì„ ë§Œë“¤ê³ ,
        
        ì´í›„ ëŒ€ì¹­ ë˜ì¹«ì„ ìœ„í•´ â€œì‹œì‘ì â€ì„ ì„¤ì •í•©ë‹ˆë‹¤.
        
2. **`SessionCipher.encrypt(plain)`**
    - **Symmetric-Key Ratchet**
        - `root key` â†’ KDF â†’ **chain key** ìƒì„±
        - `chain key` â†’ ë‹¤ì‹œ KDF â†’ ì´ë²ˆ ë©”ì‹œì§€ì˜ **message key** íŒŒìƒ
    - **AES-GCM AEAD ì•”í˜¸í™”**
        - `message key`ë¥¼ AES-GCMì˜ í‚¤ë¡œ ì¨ì„œ `plain`ì„ ì•”í˜¸í™”
        - ì•”í˜¸ë¬¸ì— ë¬´ê²°ì„± ê²€ì‚¬ìš© MAC(tag)ì„ ìë™ìœ¼ë¡œ ë¶™ì—¬ì¤Œ
    - ë°˜í™˜ê°’ì¸ `CiphertextMessage` ì•ˆì—
        - í—¤ë”(Header: DH ê³µê°œí‚¤, ë©”ì‹œì§€ ì¸ë±ìŠ¤â€¦)
        - ì•”í˜¸ë¬¸(`ciphertext`) + MAC(`tag`)
            
            ê°€ ëª¨ë‘ ë‹´ê¹ë‹ˆë‹¤.
            

---

## 4. ë³µí˜¸í™”: `decrypt(...)`

```kotlin

fun decrypt(remoteAddress: SignalProtocolAddress, msg: CiphertextMessage): ByteArray {
    val cipher = SessionCipher(store, remoteAddress)
    return when (msg) {
        is PreKeySignalMessage -> cipher.decrypt(msg)  // ì²« ë©”ì‹œì§€
        is SignalMessage       -> cipher.decrypt(msg)  // í›„ì† ë©”ì‹œì§€
        else                   -> throw IllegalArgumentException("Unknown message type")
    }
}

```

1. **í—¤ë”ì—ì„œ DH ê³µê°œí‚¤ ì½ê¸°**
    - `PreKeySignalMessage`ì¸ ê²½ìš°:
        - í—¤ë”ì— ë‹´ê¸´ ìƒëŒ€ë°©ì˜ ì„ì‹œ DH ê³µê°œí‚¤ë¥¼ êº¼ë‚´
        - ë‚˜ì˜ ëŒ€ì‘ DH ë¹„ë°€í‚¤ë¡œ ë‘ ë²ˆì§¸ DH ì—°ì‚° â†’ **root key** ê°±ì‹ 
    - `SignalMessage`ì¸ ê²½ìš°:
        - Symmetric-Key Ratchetë§Œ ì ìš© (ì´ë¯¸ root key ì¤€ë¹„ë¨)
2. **Symmetric-Key Ratchet & AEAD ë³µí˜¸í™”**
    - ì²´ì¸ í‚¤ë¥¼ í†µí•´ ì˜¬ë°”ë¥¸ `message key`ë¥¼ íŒŒìƒ
    - AES-GCM ë³µí˜¸í™”:
        - ì•”í˜¸ë¬¸ + íƒœê·¸ë¥¼ ë„£ê³ , MAC ê²€ì¦ì— ì„±ê³µí•´ì•¼ ë³µí˜¸í™” ì§„í–‰
    - ê²°ê³¼ëŠ” `ByteArray(í‰ë¬¸)`

---

### ì „ì²´ í˜¸ì¶œ íë¦„ ì˜ˆì‹œ

```kotlin

// ì†¡ì‹  ì¸¡
val addr = SignalProtocolAddress("DEVICE_B", 1)
val cipherMsg = CryptoManager.encrypt(addr, "Hello, BLE Mesh!".toByteArray())

// ë„¤íŠ¸ì›Œí¬ ì „ì†¡ â†’ ì¤‘ê°„ ë…¸ë“œë“¤ í¬ì›Œë”© (ì•”í˜¸ í•´ì œ ë¶ˆê°€)

// ìˆ˜ì‹  ì¸¡
val decryptBytes = CryptoManager.decrypt(addr, cipherMsg)
val text = String(decryptBytes)  // "Hello, BLE Mesh!"

```

- **ì†¡ì‹ **: `encrypt()` ì•ˆì—ì„œ
    - â‘  DH Ratchet (ìµœì´ˆ root key)
    - â‘¡ Symmetric Ratchet (message key)
    - â‘¢ AES-GCM ì•”í˜¸í™” + MAC íƒœê·¸
- **ìˆ˜ì‹ **: `decrypt()` ì•ˆì—ì„œ
    - â‘  í—¤ë”ì˜ DH ê³µê°œí‚¤ë¡œ DH Ratchet (root key ê°±ì‹ )
    - â‘¡ Symmetric Ratchet (message key íŒŒìƒ)
    - â‘¢ AES-GCM ë³µí˜¸í™” + MAC ê²€ì¦